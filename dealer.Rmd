---
output:
  pdf_document: default
  html_document: default
---
Tables: CFDETSyyyy; CFDERSyyyy 

Location: Sole

Schema: CFDBS

## Overview
The dealer data are transaction-level pricing at the level of the “market-category.”  These data are primarily generated through mandatory reporting by federally-permitted fish dealers.  The federal reporting is supplemented with data from non-federally-permitted (state-only) fish dealers.  Data are currently reported electronically in partnership with ACCSP through SAFIS.

+ CFDETSyyyy contains “detailed species data” for 1994-2003
+ CFDERSyyyy contains “detailed species data” for 2004-present
        
        
## Current Collection Methods
These data are the result of mandatory federal dealer reporting at the “trip-level”, supplemented by state-level, aggregated reporting.  Federally permitted fish dealers that are required to report purchases of all fish to NMFS.

## Changes to Collections Methods
+ The number of species triggering these requirements have increased over time, which has implications for completeness (50 CFR 648.6). For example, mandatory dealer reporting for Monkfish, herring, and hagfish began in 1999, 2001, and 2007 respectively.

+ Mandatory electronic reporting began in 2004. This improved quality of data, in particular, the collection of VTRSERNO,which improves matching to VTR data.        

## Tips `n Tricks
+ A dealer-veslog link can be made reasonbly well starting in 2005.  To make this link, match the the CFDBS.VTRSERNO to VESLOG.SERIAL_NUM.  Chances are that you care about Trip-level outcomes: be careful, because a vessel may have more than one SERIAL_NUM per TRIPID in the VESLOG tables.

## General Caveats
* Dealers are only required to record one VTR serial per trip.  

* Outlier prices are always possible.  Filter these out carefully.

* The following species are sketchy:

    + Surfclam and Ocean Quahog dealer reports are contained in the SFCLAM schema (separate from CFDBS).  It is unclear whether reports of SC and OQ in CFDETS and CFDERS are duplicates or not, particularly for landings of Maine Mahogany Clam [Walden].

    + Giant Bluefin Tuna dealer are supposed to be reported individually and should be in a different schema.  Giant Bluefin Tuna in CFDERS are either misreporting or duplication [George Silva, NMFS HMS].

    + Herring stock assessments do not necessarily use Dealer data as the source for assessments [Jon Deroba, PDB].  This is because Maine DMR has collected herring data and comprises the population of catch. The dealer data does not match the ME DMR data for herring quantity landed.

* There are many species that have two NESPP3 codes (As of March,2018). 
    + Cod (080, 081) 
    + Monkfish (011, 012)
    + Winter flounder (119, 120)
    + Yellowtail flounder (122, 123)
    + Plaice (124, 125)
    + Haddock (147, 148)
    + White hake (153, 154).  155 is Red/White mixed
    + Pollock (269, 270)
    
This bit of code may help:```select * from cfspp order by doc desc;```

* Some species were/are grouped together, but subsequently split apart. 

    +  Tilefish, which starts as NK, but becomes Blueline and Golden. 
    +  Skates
    
This bit of code may help:```select * from cfspp order by doc desc;```

* Data derived from “state” reporting may not include all fields that are populated by “federally reported” dealer reports.  This may affect the PORT, COUNTY, PORT2, PERMIT, HULLNUM, VTRSERNO, MONTH, and DAY fields.
    +  Permit numbers may be encoded as  000000, 190998,390998 depending on vessel size.

*  Many NESPP4 codes will not match well to VTR’s SPPCODE. For example, VTR cod is all 0818 (unclassifed round). Almost all Cod will eventually be classified when sold; there is very little 0818 in dealer data.

* Ports are inconsistently encoded over time. 
    + Some “port groups” were split into mutiple ports.  (Hampton, Seabrook, and Hampton/Seabrook, NH is a good example).
    + Many records are entered only at the “state” or “county” level.  This is particularly frequent for “older” records and non-federal reports that are received through SAFIS.
    + The names corresponding to the port codes may or may not match to Census “units.”  The 2 digit state code does not correspond to FIPS codes.  
    + There is a table POPLACE_BASE that contains some Census Places. I'm not sure who made this, or if it's currently maintained.
    
* Live and Landed weights are recorded.  
    + Scallop in-shell prices can be quite variable.
    + miscellaneous "parts" like monk liver, cod cheeks, or skate racks will have zero or null SPPLIVLB.

## Sample Projects
+ Construct prices for fish [Lee, Demarest, Ardini].
+ Construct trip revenues, post 2005 [Demarest]
+ Commercial Landings and Revenues for the “Community Profiles.” [Olson, Colburn]
+ “The record” of commercial landings for use in stock assessment.  Sort of. An "Area Allocation" usually need to be performed, because some species have multiple, spatially distinct stocks.[PopDy]
+ Construct entity-level gross revenues from commercial fishing for Regulatory Flexibility Act Analyses [Lee].  

## Update Frequency and Completeness
+ Nightly updates. Expect approximately 300 changes or additions to the current and previous year of data per day.
+ Data is “complete” 6-9 months after the end of the calendar year; however, small changes are always occurring.
+ This has consequences for reproducibility if you do not store a copy of the data.


## Other Metadata sources
+ INPORT.  https://inport.nmfs.noaa.gov/inport/item/12205
+ NEFSC's Data Dictionary  http://nova.nefsc.noaa.gov/datadict/

+ Preceded by: “Weighout” (WODETSyy and WODETTyy)
+ Succeeded by: n/a

## Related Tables
+ CFDERSyyyyAA tables - “perform some Area Allocation”
+ CFDETSyyyyAA tables - “perform some Area Allocation”
+ CFDETTyyyy contains “detailed trip data”  for 1994-2003
+ CFSUMTyyyy, CFSUMSyyyy - “summary tables” for 1994-2003
+ CFLENyyyy -fish-level port sampling data.
+ CFAGEyyyy - fish-level port sampling data.

## Support Tables
+ PORT, VALID_PORTS
+ GEAR
+ SPECIES_ITIS_NE  decodes into names, links to the species_itis system
+ CFSPP - decodes NESPP3 and NESPP4 into names

```{r dealer unique , tab.cap="Unique  fields \\label{dealer_unique}", echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
|	Column	|	Description
|:---------------	|:--------------------------------------------------------
|	SPPLNDLB	|	
|	SPPVALUE	|	
|	UTILCD	|	Quality unknown
|	DISPOSITION_CODE	|	Quality unknown 
|	REPORTED_QUANTITY	|	
|	UOM	|	
|	GRADE_CODE	|	
|	MARKET_CODE	|	
|	SPPLIVB	|	Certain NESPP4 codes (monkfish livers, cod milt) convert into zero “live pounds.”  This is done to prevent potential double counting during the stock assessment.
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```

```{r dealer primary, tab.cap="Primary Source fields -  These fields are firsthand data. \\label{dealer_primary}", echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
|	Column	|	Description
|:---------------	|:--------------------------------------------------------
|	YEAR	|	This may not be the same as the year in which fish was caught.
|	MONTH	|	This may not be the same as the month in which fish was caught.  May be zero.
|	DAY	|	This may not be the same as the day in which fish was caught.  May be zero.
|	DEALNUM	|	Dealer Identification number
|	NESPP4 [3]	|	There are 4 species codes (NESPP3, NESPP4, WHSPP, SPECIES_ITIS). 
|	WHSPP	|	
|	SPECIES_ITIS	|	
|	STATE_DNUM	|	
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```

```{r dealer secondary, tab.cap="Secondary Source Fields. These fields might be more accurate somewhere else.  \\label{dealer_secondary}", echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
|	Column	|	Description
|:---------------	|:--------------------------------------------------------
|	PORT	|	 Concatenation of state, port, county
|	COUNTY	|	Data dictionary claims this is a string, but it is a 2 digit code.
|	NEGEAR	|	
|	NEGEAR2	|	
|	NEMAREA	|	
|	AREA	|	
|	HARVEST_AREA	|	
|	DEPTHCD	|	
|	SUBTRIP	|	
|	TONCLASS [TONCL1,TONCL2]	|	
|	FZONE	|	
|	PERMIT	|	
|	HULLNUM	|	
|	VTRSERNO	|	
|	SPRATIO	|	
|	FIPS_STATE	|	
|	FIPS_PLACE	|	
|	FIPS_COUNTY	|	
|	CF_LICENSE	|	
|	NEGEAR_VTR	|	
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```

```{r dealer QAQC, tab.cap="QAQC columns. Quality Control or Auditing fields.  \\label{dealer_QAQC}", echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
|	Column	|	Description
|:---------------	|:--------------------------------------------------------
|	LINK	|	
|	DOCN	|	
|	EFFIND	|	
|	SOURCE	|	
|	DERSOURCE	|	
|	PARTNER_ID	|	
|	DEALER_RPT_ID	|	
|	DOE	|	
|	LANDING_SEQ	|	
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```

